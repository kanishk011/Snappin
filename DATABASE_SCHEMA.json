{
  "schemaVersion": "1.0.0",
  "lastUpdated": "2025-10-28",
  "description": "Snappin Chat Application - Firestore Database Schema",
  "collections": {
    "users": {
      "description": "User profiles and authentication data",
      "documentId": "Firebase Auth UID (e.g., wKAgXoTnQsMMCmV3pWohal4yexA3)",
      "fields": {
        "_id": {
          "type": "string",
          "required": true,
          "description": "User ID (same as document ID)"
        },
        "name": {
          "type": "string",
          "required": true,
          "description": "User display name"
        },
        "email": {
          "type": "string",
          "required": false,
          "description": "User email address"
        },
        "avatar": {
          "type": "string (URL)",
          "required": false,
          "description": "Profile picture URL from Firebase Storage"
        },
        "status": {
          "type": "enum",
          "required": true,
          "values": ["online", "offline"],
          "description": "User online status"
        },
        "lastSeen": {
          "type": "Timestamp",
          "required": true,
          "description": "Last active timestamp"
        },
        "createdAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Account creation time"
        },
        "updatedAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Last profile update time"
        }
      },
      "example": {
        "_id": "wKAgXoTnQsMMCmV3pWohal4yexA3",
        "name": "John Doe",
        "email": "john@example.com",
        "avatar": "https://firebasestorage.googleapis.com/.../avatar.jpg",
        "status": "online",
        "lastSeen": "Timestamp(2025-10-28 10:29:00)",
        "createdAt": "Timestamp(2025-10-20 09:00:00)",
        "updatedAt": "Timestamp(2025-10-28 10:29:00)"
      }
    },
    "chats": {
      "description": "Personal one-on-one conversations",
      "documentId": "Format: userId1_userId2 (sorted alphabetically, e.g., 8DDX...C73_wKAg...xA3)",
      "fields": {
        "_id": {
          "type": "string",
          "required": true,
          "description": "Chat ID (format: userId1_userId2, sorted)"
        },
        "type": {
          "type": "string",
          "required": true,
          "value": "personal",
          "description": "Always 'personal' for personal chats"
        },
        "participants": {
          "type": "array<string>",
          "required": true,
          "description": "Array of exactly 2 user IDs"
        },
        "lastMessage": {
          "type": "string | null",
          "required": true,
          "description": "Text preview of last message"
        },
        "lastMessageTime": {
          "type": "Timestamp | null",
          "required": true,
          "description": "Timestamp of last message"
        },
        "createdAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Chat creation time"
        },
        "unreadCount": {
          "type": "object",
          "required": false,
          "description": "Unread message count per user",
          "structure": {
            "[userId]": "number"
          }
        }
      },
      "example": {
        "_id": "8DDXEVhIzDdddLAqWu2QPQJBlC73_wKAgXoTnQsMMCmV3pWohal4yexA3",
        "type": "personal",
        "participants": [
          "8DDXEVhIzDdddLAqWu2QPQJBlC73",
          "wKAgXoTnQsMMCmV3pWohal4yexA3"
        ],
        "lastMessage": "Hi",
        "lastMessageTime": "Timestamp(2025-10-28 10:29:00)",
        "createdAt": "Timestamp(2025-10-20 09:30:00)",
        "unreadCount": {
          "8DDXEVhIzDdddLAqWu2QPQJBlC73": 2,
          "wKAgXoTnQsMMCmV3pWohal4yexA3": 0
        }
      }
    },
    "groups": {
      "description": "Group conversations",
      "documentId": "Auto-generated by Firestore (e.g., cKuMkZIArrdKlSJEd0I)",
      "fields": {
        "_id": {
          "type": "string",
          "required": true,
          "description": "Group ID (auto-generated)"
        },
        "name": {
          "type": "string",
          "required": true,
          "description": "Group name"
        },
        "avatar": {
          "type": "string (URL)",
          "required": false,
          "description": "Group picture URL"
        },
        "description": {
          "type": "string",
          "required": false,
          "description": "Group description"
        },
        "members": {
          "type": "array<string>",
          "required": true,
          "description": "Array of member user IDs"
        },
        "admins": {
          "type": "array<string>",
          "required": true,
          "description": "Array of admin user IDs"
        },
        "createdBy": {
          "type": "string",
          "required": true,
          "description": "User ID of group creator"
        },
        "lastMessage": {
          "type": "string | null",
          "required": true,
          "description": "Text preview of last message"
        },
        "lastMessageTime": {
          "type": "Timestamp | null",
          "required": true,
          "description": "Timestamp of last message"
        },
        "createdAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Group creation time"
        },
        "updatedAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Last group update time"
        },
        "unreadCount": {
          "type": "object",
          "required": false,
          "description": "Unread message count per user",
          "structure": {
            "[userId]": "number"
          }
        }
      },
      "example": {
        "_id": "cKuMkZIArrdKlSJEd0I",
        "name": "Project Team",
        "avatar": "https://firebasestorage.googleapis.com/.../group.jpg",
        "description": "Team discussion group",
        "members": ["user1", "user2", "user3"],
        "admins": ["user1"],
        "createdBy": "user1",
        "lastMessage": "Meeting at 3pm",
        "lastMessageTime": "Timestamp(2025-10-28 10:29:00)",
        "createdAt": "Timestamp(2025-10-20 09:00:00)",
        "updatedAt": "Timestamp(2025-10-28 10:29:00)",
        "unreadCount": {
          "user1": 0,
          "user2": 5,
          "user3": 3
        }
      }
    },
    "messages": {
      "description": "Messages within chats and groups (SUBCOLLECTION)",
      "path": "chats/{chatId}/messages or groups/{groupId}/messages",
      "documentId": "Auto-generated by Firestore",
      "fields": {
        "_id": {
          "type": "string",
          "required": true,
          "description": "Message ID (client-generated unique ID)"
        },
        "text": {
          "type": "string",
          "required": true,
          "description": "Message text content"
        },
        "createdAt": {
          "type": "Timestamp",
          "required": true,
          "description": "Message creation time"
        },
        "user": {
          "type": "object",
          "required": true,
          "description": "Sender information",
          "fields": {
            "_id": {
              "type": "string",
              "required": true,
              "description": "Sender user ID"
            },
            "name": {
              "type": "string",
              "required": true,
              "description": "Sender display name"
            },
            "avatar": {
              "type": "string (URL)",
              "required": false,
              "description": "Sender avatar URL"
            }
          }
        },
        "image": {
          "type": "string (URL) | null",
          "required": false,
          "description": "Image attachment URL"
        },
        "video": {
          "type": "string (URL) | null",
          "required": false,
          "description": "Video attachment URL"
        },
        "audio": {
          "type": "string (URL) | null",
          "required": false,
          "description": "Audio attachment URL"
        },
        "document": {
          "type": "object | null",
          "required": false,
          "description": "Document attachment",
          "fields": {
            "url": {
              "type": "string (URL)",
              "required": true,
              "description": "Document download URL"
            },
            "name": {
              "type": "string",
              "required": true,
              "description": "Document file name"
            },
            "size": {
              "type": "number",
              "required": false,
              "description": "File size in bytes"
            },
            "type": {
              "type": "string",
              "required": false,
              "description": "MIME type (e.g., application/pdf)"
            }
          }
        },
        "replyTo": {
          "type": "object | null",
          "required": false,
          "description": "Reply to another message",
          "fields": {
            "_id": {
              "type": "string",
              "required": true,
              "description": "Original message ID"
            },
            "text": {
              "type": "string",
              "required": true,
              "description": "Original message text"
            },
            "user": {
              "type": "object",
              "required": true,
              "fields": {
                "_id": {
                  "type": "string",
                  "required": true,
                  "description": "Original sender ID"
                },
                "name": {
                  "type": "string",
                  "required": true,
                  "description": "Original sender name"
                }
              }
            }
          }
        },
        "readBy": {
          "type": "array<object>",
          "required": true,
          "description": "Array of read receipts",
          "itemStructure": {
            "userId": {
              "type": "string",
              "required": true,
              "description": "User ID who read the message"
            },
            "timestamp": {
              "type": "Timestamp",
              "required": true,
              "description": "When they read it"
            }
          }
        },
        "edited": {
          "type": "boolean",
          "required": false,
          "description": "Whether message was edited"
        },
        "editedAt": {
          "type": "Timestamp",
          "required": false,
          "description": "When message was edited"
        },
        "deleted": {
          "type": "boolean",
          "required": false,
          "description": "Soft delete flag"
        },
        "deletedAt": {
          "type": "Timestamp",
          "required": false,
          "description": "When message was deleted"
        }
      },
      "examples": {
        "textMessage": {
          "_id": "1000235702",
          "text": "Hi",
          "createdAt": "Timestamp(2025-10-28 10:29:00)",
          "user": {
            "_id": "wKAgXoTnQsMMCmV3pWohal4yexA3",
            "name": "John Doe",
            "avatar": "https://..."
          },
          "image": null,
          "video": null,
          "audio": null,
          "document": null,
          "replyTo": null,
          "readBy": [
            {
              "userId": "wKAgXoTnQsMMCmV3pWohal4yexA3",
              "timestamp": "Timestamp(2025-10-28 10:29:00)"
            },
            {
              "userId": "8DDXEVhIzDdddLAqWu2QPQJBlC73",
              "timestamp": "Timestamp(2025-10-28 10:30:00)"
            }
          ],
          "edited": false,
          "deleted": false
        },
        "imageMessage": {
          "_id": "1000235703",
          "text": "",
          "createdAt": "Timestamp(2025-10-28 10:30:00)",
          "user": {
            "_id": "user1",
            "name": "John"
          },
          "image": "https://firebasestorage.googleapis.com/.../image.jpg",
          "video": null,
          "audio": null,
          "document": null,
          "replyTo": null,
          "readBy": [
            {
              "userId": "user1",
              "timestamp": "Timestamp(2025-10-28 10:30:00)"
            }
          ]
        },
        "documentMessage": {
          "_id": "1000235704",
          "text": "ðŸ“„ contract.pdf",
          "createdAt": "Timestamp(2025-10-28 10:31:00)",
          "user": {
            "_id": "user1",
            "name": "John"
          },
          "image": null,
          "video": null,
          "audio": null,
          "document": {
            "url": "https://firebasestorage.googleapis.com/.../contract.pdf",
            "name": "contract.pdf",
            "size": 1048576,
            "type": "application/pdf"
          },
          "replyTo": null,
          "readBy": [
            {
              "userId": "user1",
              "timestamp": "Timestamp(2025-10-28 10:31:00)"
            }
          ]
        },
        "replyMessage": {
          "_id": "1000235705",
          "text": "That sounds good!",
          "createdAt": "Timestamp(2025-10-28 10:32:00)",
          "user": {
            "_id": "user2",
            "name": "Jane"
          },
          "image": null,
          "video": null,
          "audio": null,
          "document": null,
          "replyTo": {
            "_id": "1000235702",
            "text": "Hi",
            "user": {
              "_id": "user1",
              "name": "John"
            }
          },
          "readBy": [
            {
              "userId": "user2",
              "timestamp": "Timestamp(2025-10-28 10:32:00)"
            }
          ]
        }
      }
    }
  },
  "collectionStructure": {
    "users": "Top-level collection",
    "chats": "Top-level collection",
    "groups": "Top-level collection",
    "chats/{chatId}/messages": "Subcollection of chats",
    "groups/{groupId}/messages": "Subcollection of groups"
  },
  "indexesRequired": [
    {
      "collection": "chats",
      "fields": ["participants", "lastMessageTime"],
      "order": "descending on lastMessageTime"
    },
    {
      "collection": "groups",
      "fields": ["members", "lastMessageTime"],
      "order": "descending on lastMessageTime"
    },
    {
      "collection": "messages",
      "fields": ["createdAt"],
      "order": "descending"
    }
  ],
  "securityRules": {
    "note": "See firestore.rules file for complete security rules",
    "summary": [
      "Users can read/write their own profile",
      "Users can read chats/groups they are part of",
      "Users can only update readBy field in messages",
      "Users can delete their own messages",
      "Group creators can delete groups"
    ]
  },
  "notes": [
    "All timestamps use Firebase Timestamp type",
    "Chat IDs are deterministic: sorted user IDs joined with underscore",
    "Group IDs are auto-generated by Firestore",
    "Messages use soft delete (deleted flag instead of actual deletion)",
    "Read receipts are tracked per user in the readBy array",
    "Unread counts are maintained in chat/group documents for performance",
    "Only one attachment type (image/video/audio/document) per message",
    "Message IDs are client-generated for offline support"
  ]
}
